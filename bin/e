#!/usr/bin/env bash

set -eo pipefail
shopt -s nullglob

EDITOR=${EDITOR:=nvim}

VIM_OPTIONS=

if [[ $# -ne 0 && $EDITOR == *"vim"* ]]; then
    VIM_OPTIONS="-O "
fi

if [[ $EDITOR == *"nvim"* && -e $NVIM_LISTEN_ADDRESS ]]; then
    if [[ $# -ne 0 ]]; then
        nvr -cc wincmd\ p $VIM_OPTIONS "$@"
    else
        nvr -cc vnew $VIM_OPTIONS "$@"
    fi
else
    $EDITOR $VIM_OPTIONS "$@"
fi
